// JavaScript Document
$(document).ready(function(){

	$(".progressbar").each(function(){
		$(this).children(".gray").children("div").css("width",$(this).children(".percent").html())
	});
	
	function resetloc(){
		//$(".banner > .wrap > .item:eq(1)").css("left","0px");
		$(".banner > .wrap > .item:eq("+ $(".banner .switch .hover").attr("data") +")").css("left","0px").show();
		$(".banner .temp").css("left","1000px");
	}
	function tooglebanner(o){
		var obj;
		if(o == null){
			//alert(($(".banner .switch .hover").attr("data") * 1 + 1) < ($(".banner .wrap .switch li").size()*1));
			var n = ($(".banner .switch .hover").attr("data") * 1) < ($(".banner .wrap .switch li").size()*1-1)?$(".banner .switch .hover").attr("data"):-1;
			obj = $(".banner .switch li:eq("+(n*1+1)+")");
		}
		else{obj = o;}
		$(".banner .switch li").removeClass("hover");
		obj.addClass("hover");
		obj.parent(".switch").parent(".wrap").children(".item").animate({left:"-1000px"},3000);
		$(".banner .temp").html(obj.parent(".switch").parent(".wrap").children(".item:eq("+obj.attr("data")+")").html()).animate({left:"0px"},3000,resetloc);
	}
	$(".banner .switch li").click(function(){
		tooglebanner($(this));
	});
	
	var changebanner = setInterval(tooglebanner,5000);
	$(".banner .wrap").mouseover(function(){
		clearInterval(changebanner);
	});
	$(".banner .wrap").mouseout(function(){
		changebanner = setInterval(tooglebanner,5000);
	});
	
	$(".tabmenu li").click(function(){
		$(".tabmenu li").removeClass("hover");
		$(this).addClass("hover");
		$(".tabmenu").nextAll(".tabitem").hide();
		$(".tabmenu").parent("div").children("."+$(this).attr("data")).show();
	});
	
	$(".extend").click(function(){
		if($(this).attr("class") == "extend"){
			$(this).addClass("pack");
			$(this).children("a").html("收起");
			$(this).parent("div").children("span").show();
		}
		else{
			$(this).removeClass("pack");
			$(this).children("a").html("更多");
			$(this).parent("div").children(".ep").hide();
		}
	});
	$(".intro .sidemenu li a").click(function(){
		$(".intro .sidemenu li").removeClass("hover");
		$(this).parent("li").addClass("hover");
	});
	$(document).scroll(function(){
		if($(".intro .sidemenu").size() == 1){
			$(".intro .sidemenu").css("top",($(document).scrollTop() - 200) +"px");
		}	
	});


	//加载保利视频
	if($("#plv_video").length>0){
		var player = polyvObject('#plv_video').videoPlayer({
		'width':'600',
		'height':'337',
		'vid' : $("#plv_video").attr('data')
		});
	}else{
		//alert('没有视频');
	}

	//认购按钮弹出
	//模态框的各类方法
  if($('#investModal').length	> 0){
  	$('#btn_invest').click(function(){
  		$('#investModal').modal("show");
  		//$('#phone').val('');
  		//$('#code').val('');
  		$('#alert_field').html('');
  	});

  	$('#btn_invest_sure').click(function(){
  		//set_alert('认购功能正在调试，请稍后再试','alert-info');
  		price = $("#invest-money").val().trim();
		type = $(this).attr('ptype');
		id = $(this).attr('pid');
		min = $(this).attr('min');
		if(parseFloat(price) < parseFloat(min)){
			set_alert('认购金额小于认购起点','alert-info');
		}else{
			$.post("/c/invest/", {
			'type': type,
			'id': id,
			'price': price
			},
			function(data, status) {
				if (data.status == -1) {
					window.location.href = "/c/login/";
				} else if (data.status == 1) {
					set_alert('认购成功','alert-info');
					setTimeout(function(){
						window.location.reload();
					},1000);
				}
			});
		}
  		
  	});
  }
})

//设置警告框内容和样式
function set_alert(msg,type){
	content = "<div class='alert "+type+" '><button type='button' class='close' data-dismiss='alert'>&times;</button> <strong>"+msg+"</strong></div>"
	$('#alert_field').html(content);
}

